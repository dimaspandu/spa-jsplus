/**
 * @license JS+ (SPA) v1.0.0 (ES5 compatible)
 * jsplus/spa/1.0.0/spa.min.js
 *
 * Rewritten to be ES5-compatible and documented in English.
 *
 * Copyright (c) dimaspandu
 * Licensed under MIT
 */
!function(t){"use strict";function e(t){return"function"==typeof t}function r(t,r){if(e(t))return setTimeout(t,r)}function i(e){try{if(!e)return;0===e.delay?e.set():r(e.set,e.delay)}catch(e){t&&t.console&&t.console.error&&t.console.error("onIgnitedEventContext error:",e&&e.message?e.message:e)}}function a(e,r,i,a){var o={origin:i,request:a},s=(e.options.hashtag?t.location.pathname+e.options.dividerPath:e.options.baseUrl+"")+a;if("replace"===r&&t.history&&t.history.replaceState)t.history.replaceState(o,null,s);else if(t.history&&t.history.pushState)t.history.pushState(o,null,s);else try{t.location.href=s}catch(t){}}function o(t,r){var i=t.pipe[r];if(i){var a=i.context;if(a){var o=e(a.container)?a.container():a.container,s=t.options.hostdom;if(null!==o&&s){for(;s.firstChild;)s.removeChild(s.firstChild);try{o&&void 0!==o.nodeType?s.appendChild(o):s.appendChild(document.createTextNode(String(o)))}catch(t){try{s.innerHTML=String(o)}catch(t){}}}}}}function s(t,e,r,s,n){e.params=s||{},e.query=n||{},t.pipe[r].context=e,t.pipe[r].builder(e),t.state.firstReactor.origin=r,t.state.firstReactor.request=t.originPath(),t.state.firstReactor.params=e.params,t.state.firstReactor.query=e.query,t.state.activeReactor.origin=r,t.state.activeReactor.request=t.originPath(),t.state.activeReactor.params=e.params,t.state.activeReactor.query=e.query,t.state.journey.push({origin:r,request:t.originPath(),method:"push",params:e.params,query:e.query}),t.pipe[r].context.builder.flushTransform=function(){o(t,r)},a(t,"replace",r,t.originPath()),t.pipe[r].context.builder.waiting||t.pipe[r].context.builder.flushTransform(),t.pipe[r].context.builder.eventTransform=function(){t.notifier.meet(),i(t.pipe[r].context.onMeet),t.notifier.arrive(),i(t.pipe[r].context.onArrive)},t.pipe[r].context.builder.waiting||t.pipe[r].context.builder.eventTransform()}function n(e,r,a,s,n,u){if("*"===a&&void 0===e.pipe["*"])return t&&t.console&&t.console.error&&t.console.error("Handler not found, there is no {spa.err(callback)} pipe cause Spa in hurry."),0;var p=e.pipe[a];if(null===p.context){var l=new c;l.params=n||{},l.query=u||{},p.context=l,p.builder(l)}else p.context.params=n||{},p.context.query=u||{};if(a!==e.state.activeReactor.origin&&(p.context.builder.flushTransform=function(){o(e,a)},p.context.builder.waiting||p.context.builder.flushTransform()),"replace"!==r&&(e.state.previousReactor.origin=e.state.activeReactor.origin,e.state.previousReactor.request=e.state.activeReactor.request,e.state.previousReactor.params=e.state.activeReactor.params,e.state.previousReactor.query=e.state.activeReactor.query),e.state.activeReactor.origin=a,e.state.activeReactor.request=s,e.state.activeReactor.params=n||{},e.state.activeReactor.query=u||{},"replace"===r){var h=e.state.journey.length-1;h>=0?(e.state.journey[h].origin=a,e.state.journey[h].request=s,e.state.journey[h].method=r,e.state.journey[h].params=n||{},e.state.journey[h].query=u||{}):e.state.journey.push({origin:a,request:s,method:r,params:n||{},query:u||{}})}else e.state.journey.push({origin:a,request:s,method:r,params:n||{},query:u||{}});p.context.builder.eventTransform=function(){if(e.notifier.meet(),i(p.context.onMeet),e.notifier.arrive(),i(p.context.onArrive),"*"!==a&&null===p.context.container)if(void 0===p.catcher)try{e.options.hostdom.innerHTML='<div style="height: 100vh; padding: 20px; width: 100%;"><h1 style="font-size: 5rem; line-height: 1;">Blank Screen</h1><p style="color: #585858; font-size: 2rem; margin-top: 8px;">No reactor catcher.</p><span style="color: #11a3c4; display: block; font-size: 2rem; font-weight: bold; margin-top: 8px; text-decoration: underline;" onclick="window.history.back();">BACK</span></div>'}catch(t){}else p.catcher(p.context),o(e,a)},p.context.builder.waiting||p.context.builder.eventTransform()}function c(){this.params={},this.query={},this.container=null,this.builder=Object.seal({waiting:!1,flushTransform:function(){},eventTransform:function(){},future:function(t){var e=this;this.waiting=!0;try{t((function(t){"function"!=typeof t&&(t=function(){}),e.waiting=!1;try{t()}catch(t){}try{e.flushTransform()}catch(t){}try{e.eventTransform()}catch(t){}}))}catch(t){this.waiting=!1}}}),this.onMeet=Object.seal({delay:0,set:function(){}}),this.onArrive=Object.seal({delay:0,set:function(){}}),this.onExit=Object.seal({delay:0,set:function(){}}),this.onComeback=Object.seal({delay:0,set:function(){}}),Object.seal(this)}function u(e){var r,i=void 0===(e=e||{}).baseUrl?"":String(e.baseUrl);i="string"!=typeof(r=i)?r:r.length>0&&"/"===r.charAt(r.length-1)?r.slice(0,-1):r;var a=void 0===e.dividerPath?"#":String(e.dividerPath),o=void 0===e.hashtag||!!e.hashtag,s=void 0===e.hostdom?document.body:e.hostdom;this.options=Object.seal({baseUrl:i,dividerPath:a,hashtag:o,hostdom:s}),this.options.hashtag||this.options.baseUrl&&0!==this.options.baseUrl.length||t&&t.console&&t.console.error&&t.console.error("There is no {baseUrl} set in instance of spa arguments options while disabling hashtag options."),!this.options.hashtag&&this.options.baseUrl.length>0&&("#"!==this.options.dividerPath&&this.options.dividerPath!==this.options.baseUrl&&t&&t.console&&t.console.warn&&t.console.warn("Please set {dividerPath} same as {baseUrl} while disabling hashtag options."),this.options.dividerPath=this.options.baseUrl),Object.freeze(this)}u.prototype.requestPath=function(){var e=t.location.href.split(this.options.dividerPath);return void 0!==e[1]?e[1]:e[0]},u.prototype.originPath=function(){var e=this.requestPath(),r=-1===e.indexOf("?")?e:e.split("?")[0];return r.length===t.location.href.length&&(r="/"),r},u.prototype.pipe={},u.prototype.pipeCache={},u.prototype.state=Object.seal({firstReactor:Object.seal({origin:null,request:null,params:{},query:{}}),previousReactor:Object.seal({origin:null,request:null,params:{},query:{}}),activeReactor:Object.seal({origin:null,request:null,params:{},query:{}}),journey:[],navigateBlocker:{queue:0,works:!1}}),u.prototype.notifier=Object.seal({transition:function(){},meet:function(){},arrive:function(){},exit:function(){},comeback:function(){}}),u.prototype.reactor=function(t,e,r){var i=this;function a(t){i.pipe[t]={context:null,builder:e,catcher:r}}if("[object Array]"===Object.prototype.toString.call(t))for(var o=0;o<t.length;o++)a(t[o]);else a(t);return this},u.prototype.err=function(t,e){return this.pipe["*"]={context:null,builder:t,catcher:e},this},u.prototype.navigator=function(t,e,r){var i=t,a={},o={};if(-1!==t.indexOf("?")){for(var s=t.split("?")[1].split("&"),n=0;n<s.length;n++){var c=s[n].split("=");c.length>0&&(o[c[0]]=void 0===c[1]?"":c[1])}i=t.split("?")[0]}if(void 0!==this.pipe[i])return e(i,a,o),void(this.pipeCache[t]={originPath:i,params:a,query:o});var u=i.split("/"),p={exists:!1,origin:i};for(var l in this.pipe)if(this.pipe.hasOwnProperty(l)){var h=l.split("/"),v=h.length,f=u.length;if(-1!==l.indexOf("{")&&v===f){for(var g=!0,y={},d=0;d<v;d++){if(-1!==h[d].indexOf("{"))y[h[d].replace("{","").replace("}","")]=u[d];else if(h[d]!==u[d]){g=!1;break}}if(g){for(var m in y)y.hasOwnProperty(m)&&(a[m]=y[m]);p.exists=!0,p.origin=l;break}}}p.exists?(e(p.origin,a,o),this.pipeCache[t]={originPath:p.origin,params:a,query:o}):(r(),this.pipeCache[t]={originPath:"*",params:a,query:o})},u.prototype.navigateProcess=function(t,e){var r=this;if(void 0!==this.pipeCache[t]){var i=this.pipeCache[t];a(r,e,i.originPath,t),n(r,e,i.originPath,t,i.params,i.query)}else this.navigator(t,(function(i,o,s){a(r,e,i,t),n(r,e,i,t,o,s)}),(function(){a(r,e,"*",t),n(r,e,"*",t,{},{})}))},u.prototype.navigatePush=function(t){if(this.notifier.transition(),this.state.navigateBlocker.works){var e=this,r=!0,i=setInterval((function(){e.state.navigateBlocker.works||(e.navigateProcess(t,"push"),r=!1,clearInterval(i))}),0);setTimeout((function(){r&&(r=!1,clearInterval(i))}),1e3)}else this.navigateProcess(t,"push")},u.prototype.navigateReplace=function(t){if(this.notifier.transition(),this.state.navigateBlocker.works){var e=this,r=!0,i=setInterval((function(){e.state.navigateBlocker.works||(e.navigateProcess(t,"replace"),r=!1,clearInterval(i))}),0);setTimeout((function(){r&&(r=!1,clearInterval(i))}),1e3)}else this.navigateProcess(t,"replace")},u.prototype.navigateClear=function(){this.state.navigateBlocker.queue=this.state.journey.length,this.state.navigateBlocker.works=!0,this.state.firstReactor.origin=this.state.activeReactor.origin,this.state.firstReactor.request=this.state.activeReactor.request,this.state.firstReactor.params=this.state.activeReactor.params,this.state.firstReactor.query=this.state.activeReactor.query,this.state.previousReactor.origin=null,this.state.previousReactor.request=null,this.state.previousReactor.params={},this.state.previousReactor.query={};for(var e=this.state.journey.length-1;e>=1;e--)try{t.history.back()}catch(t){}this.state.journey=[{origin:this.state.activeReactor.origin,request:this.state.activeReactor.request,params:this.state.activeReactor.params,query:this.state.activeReactor.query}],this.navigateReplace(this.state.journey[0].request)},u.prototype.navigatePop=function(){var t,e=this,s=function(){e.state.previousReactor.origin!==e.state.activeReactor.origin&&e.pipe[e.state.previousReactor.origin]&&(e.pipe[e.state.previousReactor.origin].context.builder.flushTransform=function(){o(e,e.state.previousReactor.origin)},e.pipe[e.state.previousReactor.origin].context.builder.waiting||e.pipe[e.state.previousReactor.origin].context.builder.flushTransform()),e.state.journey.pop();var t=e.state.journey.length-1,r=e.state.journey[t];if(e.state.activeReactor.origin=r.origin,e.state.activeReactor.request=r.request,e.state.activeReactor.params=r.params,e.state.activeReactor.query=r.query,1===e.state.journey.length)e.state.previousReactor.origin=null,e.state.previousReactor.request=null,e.state.previousReactor.params=null,e.state.previousReactor.query=null;else{var a=e.state.journey[e.state.journey.length-2];e.state.previousReactor.origin=a.origin,e.state.previousReactor.request=a.request,e.state.previousReactor.params=a.params,e.state.previousReactor.query=a.query}var s=e.pipe[e.state.activeReactor.origin].context;s.params=e.state.activeReactor.params,s.query=e.state.activeReactor.query,s.builder.eventTransform=function(){e.notifier.meet(),i(s.onMeet),e.notifier.comeback(),i(s.onComeback)},s.builder.waiting||s.builder.eventTransform()},n=this.pipe[this.state.activeReactor.origin].context.onExit;try{t=n.set()}catch(e){t=void 0}if(void 0===t||t)e.notifier.exit(),0===n.delay?s():r(s,n.delay);else{a(this,"push",this.state.activeReactor.origin,this.state.activeReactor.request);var c=e.pipe[e.state.activeReactor.origin].context;c.builder.eventTransform=function(){e.notifier.meet(),i(c.onMeet),e.notifier.arrive(),i(c.onArrive)},c.builder.waiting||c.builder.eventTransform()}},u.prototype.addNotifier=function(t,e){return this.notifier[t]=e,this},u.prototype.tap=function(){try{var e=this,r=new c;this.navigator(-1===this.requestPath().indexOf("?")?this.originPath():this.requestPath(),(function(t,i,a){s(e,r,t,i,a)}),(function(){return void 0!==e.pipe["*"]?(s(e,r,"*",{},{}),1):(t&&t.console&&t.console.error&&t.console.error("Handler not found, there is no {spa.err(callback)} pipe cause Spa in hurry."),0)})),t.onpopstate=function(r){try{if(r&&r.preventDefault)try{r.preventDefault()}catch(t){}e.notifier.transition(),e.state.navigateBlocker.works&&(e.state.navigateBlocker.queue--,1===e.state.navigateBlocker.queue&&(e.state.navigateBlocker.works=!1));var i=!1;try{var a=e.pipe[e.state.activeReactor.origin].context.onExit;i=a&&-1===a.delay}catch(t){i=!1}if(i)try{t.history.go(-1)}catch(t){}else if(r&&r.state&&r.state.origin===e.state.previousReactor.origin)e.navigatePop();else if(!e.state.navigateBlocker.works&&r&&r.state&&r.state.origin){var o={},s={};try{var c=e.pipe[r.state.origin].context;o=null===c?{}:c.params||{},s=null===c?{}:c.query||{}}catch(t){o={},s={}}n(e,"push",r.state.origin,r.state.request,o,s)}}catch(e){t&&t.console&&t.console.error&&t.console.error("onpopstate handler error:",e&&e.message?e.message:e)}}}catch(e){t&&t.console&&t.console.error&&t.console.error("Spa tap error:",e&&e.message?e.message:e)}return this},t.Spa=u}(this);